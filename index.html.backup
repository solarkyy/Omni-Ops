<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omni-Ops | DEFINITIVE EDITION</title>

    <!-- Core Styles -->
    <link rel="stylesheet" href="css/omni-core.css">
    <link rel="stylesheet" href="css/omni-ue5-editor.css">
    <link rel="stylesheet" href="css/omni-pipboy.css">
    <link rel="stylesheet" href="css/omni-npc-system.css">

    <style>
        html, body{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;font-family:monospace}
        
        #loading-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;font-family:monospace;color:#0f6}
        #loading-screen.hidden{display:none}
        .loading-logo{font-size:48px;font-weight:700;margin-bottom:30px;text-shadow:0 0 20px #0f6}
        .loading-bar-container{width:400px;height:30px;border:2px solid #0f6;border-radius:15px;overflow:hidden;background:rgba(0,255,100,.1)}
        .loading-bar{height:100%;background:linear-gradient(90deg,#0f6,#00d9ff);width:0%;transition:width .3s;box-shadow:0 0 15px #0f6}
        .loading-status{margin-top:20px;font-size:14px;opacity:.8}
        .module-list{margin-top:30px;text-align:left;opacity:.6;font-size:12px}
        .module-item{margin:5px 0;padding:3px 10px}
        .module-item.loaded{color:#0f6}
        .module-item.loading{color:#ff0}
        
        #menu-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:flex;align-items:center;justify-content:center;z-index:1000;flex-direction:column}
        .menu-screen{display:none;text-align:center;background:rgba(0,0,0,0.8);padding:40px;border:2px solid #0f6;border-radius:10px;min-width:400px}
        .menu-screen.active{display:block}
        .menu-title{font-size:32px;font-weight:bold;color:#0f6;margin-bottom:10px;text-shadow:0 0 10px #0f6}
        .menu-subtitle{font-size:16px;color:#0f6;margin-bottom:30px;opacity:0.7}
        .menu-btn{width:100%;padding:12px;margin:10px 0;background:#0f6;color:#000;border:none;border-radius:5px;font-weight:bold;cursor:pointer;font-size:14px;transition:all 0.3s}
        .menu-btn:hover{background:#00d9ff;box-shadow:0 0 15px #00d9ff}
        .menu-btn.secondary{background:#333;color:#0f6;border:1px solid #0f6}
        .menu-btn.secondary:hover{background:#0f6;color:#000}
        .menu-input{width:100%;padding:10px;margin:10px 0;background:#1a1a1a;border:1px solid #0f6;color:#0f6;border-radius:5px;font-size:14px}
        .menu-input::placeholder{color:#0f6;opacity:0.5}
        
        #ui-layer{position:fixed;top:0;left:0;width:100%;height:100%;font-family:monospace;color:#0f6;pointer-events:none;z-index:500}
        #hud-top{position:absolute;top:10px;left:10px;font-size:12px}
        #hud-bottom{position:absolute;bottom:10px;left:10px;font-size:12px}
        .lobby-slot{display:inline-block;width:120px;margin:10px;padding:10px;border:1px solid #333;background:rgba(0,0,0,0.5);cursor:pointer;text-align:center}
        .lobby-slot.active{border:1px solid #0f6;background:rgba(0,255,100,0.1)}
        .lobby-slot.host-clickable{cursor:pointer}
        .lobby-slot.host-clickable:hover{background:rgba(0,255,100,0.2)}
        canvas{position:absolute;top:0;left:0;width:100%;height:100%;display:block;z-index:100}
        #pipboy-menu.open{transform:translateX(0);display:flex !important}
        #pipboy-menu{font-family:monospace}
        .editor-section{display:none}
        .editor-section.active{display:block}
        .spawn-palette{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
        .spawn-item{background:#0a3a0a;border:1px solid #0f6;padding:15px;text-align:center;cursor:pointer;font-size:24px;border-radius:5px;transition:all 0.2s}
        .spawn-item:hover{background:#0f6;color:#000;transform:scale(1.1)}
        .property-input{width:100%;padding:8px;background:#1a1a1a;border:1px solid #0f6;color:#0f6;border-radius:3px;margin:5px 0;font-family:monospace;font-size:12px}
        .dialogue-option{background:rgba(0,255,100,0.1);border:1px solid #0f6;color:#0f6;padding:12px;margin:8px 0;cursor:pointer;border-radius:5px;font-size:13px;transition:all 0.2s;text-align:left}
        .dialogue-option:hover{background:rgba(0,255,100,0.3);box-shadow:0 0 10px #0f6;transform:translateX(5px)}
        .dialogue-option.selected{background:rgba(0,255,100,0.5);box-shadow:0 0 15px #0f6;border:2px solid #0f6}
        
        /* Settings Styles */
        .settings-tab{background:#1a1a1a;color:#0f6;border:none;border-bottom:3px solid transparent;padding:10px 20px;cursor:pointer;font-size:14px;font-weight:bold;transition:all 0.3s}
        .settings-tab:hover{background:#0f6;color:#000}
        .settings-tab.active{border-bottom-color:#0f6;background:#0a3a0a}
        .settings-tab-content{color:#0f6}
        .keybind-item{display:flex;flex-direction:column;padding:10px;background:rgba(0,255,100,0.05);border:1px solid #0f6;border-radius:5px;gap:5px}
        .keybind-label{font-weight:bold;font-size:12px;opacity:0.8}
        .keybind-button{background:#0a3a0a;color:#0f6;border:2px solid #0f6;padding:8px 12px;border-radius:5px;cursor:pointer;font-family:monospace;font-weight:bold;transition:all 0.2s;font-size:13px}
        .keybind-button:hover{background:#0f6;color:#000;box-shadow:0 0 10px #0f6}
        .keybind-button.listening{background:#ff0;color:#000;animation:pulse 0.5s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.6}}
        input[type="range"]{accent-color:#0f6}
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="loading-logo">‚ö° OMNI-OPS</div>
        <div class="loading-bar-container">
            <div class="loading-bar" id="loading-bar"></div>
        </div>
        <div class="loading-status" id="loading-status">Initializing...</div>
        <div class="module-list" id="module-list"></div>
    </div>

    <div id="game-container"></div>

    <div id="menu-overlay">
        <div id="main-screen" class="menu-screen active">
            <div class="menu-title">‚ö° OMNI-OPS</div>
            <div class="menu-subtitle">THE HEROES OF ALBION</div>
            <button id="btn-story-start" class="menu-btn">üìñ Start Story</button>
            <button id="btn-single" class="menu-btn">üéÆ Quick Play</button>
            <button id="btn-show-host" class="menu-btn">üåê New Game (Host)</button>
            <button id="btn-show-join" class="menu-btn">üîó Join Game</button>
            <button id="btn-main-settings" class="menu-btn secondary">‚öôÔ∏è Settings</button>
            <div id="btn-resume" style="display:none;" class="menu-btn">‚ñ∂Ô∏è Resume Game</div>
        </div>
        
        <div id="host-screen" class="menu-screen" style="display:none;">
            <div class="menu-title">Create Game</div>
            <div style="color:#0f6; margin:20px 0; font-size:16px;">
                <strong>Room ID:</strong> <span id="host-room-id">XXXX</span>
            </div>
            <input type="text" id="host-name" class="menu-input" placeholder="Your Name">
            <button id="btn-deploy-host" class="menu-btn">Start Server</button>
            <button id="btn-host-back" class="menu-btn secondary">‚Üê Back</button>
        </div>
        
        <div id="join-screen" class="menu-screen" style="display:none;">
            <div class="menu-title">Join Game</div>
            <input type="text" id="join-room-id" class="menu-input" placeholder="Room ID">
            <input type="text" id="join-name" class="menu-input" placeholder="Your Name">
            <button id="btn-deploy-join" class="menu-btn">Join Game</button>
            <button id="btn-join-back" class="menu-btn secondary">‚Üê Back</button>
        </div>
        
        <div id="lobby-screen" class="menu-screen" style="display:none;">
            <div class="menu-title">Lobby</div>
            <div id="lobby-players" style="color:#0f6; margin:20px 0; font-size:14px;">
                <div id="slot-0" class="lobby-slot"><span></span><span></span></div>
                <div id="slot-1" class="lobby-slot"><span></span><span></span></div>
                <div id="slot-2" class="lobby-slot"><span></span><span></span></div>
                <div id="slot-3" class="lobby-slot"><span></span><span></span></div>
            </div>
            <input type="text" id="player-name" class="menu-input" placeholder="Player Name">
            <button id="btn-start-match" class="menu-btn" style="display:none;">Start Match</button>
            <button id="btn-lobby-back" class="menu-btn secondary">‚Üê Quit</button>
        </div>

        <div id="settings-screen" class="menu-screen" style="display:none;">
            <div class="menu-title">‚öôÔ∏è Settings</div>
            
            <!-- Settings Tabs -->
            <div style="display:flex; gap:10px; margin:20px 0; border-bottom:2px solid #0f6;">
                <button class="settings-tab active" data-tab="controls">üéÆ Controls</button>
                <button class="settings-tab" data-tab="graphics">üñ•Ô∏è Graphics</button>
                <button class="settings-tab" data-tab="audio">üîä Audio</button>
                <button class="settings-tab" data-tab="gameplay">‚öîÔ∏è Gameplay</button>
            </div>
            
            <!-- Controls Tab -->
            <div id="tab-controls" class="settings-tab-content" style="max-height:400px; overflow-y:auto; padding:10px 0;">
                <h3 style="color:#0f6; margin:10px 0;">Key Bindings</h3>
                <div id="keybind-list" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; font-size:13px;">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div style="margin-top:20px;">
                    <button id="btn-reset-controls" class="menu-btn secondary" style="width:auto; padding:10px 20px;">Reset to Defaults</button>
                </div>
            </div>
            
            <!-- Graphics Tab -->
            <div id="tab-graphics" class="settings-tab-content" style="display:none; padding:10px 0;">
                <h3 style="color:#0f6; margin:10px 0;">Graphics Settings</h3>
                <div style="display:flex; flex-direction:column; gap:15px; font-size:13px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label style="color:#0f6;">Mouse Sensitivity:</label>
                        <input type="range" id="mouse-sensitivity" min="0.0005" max="0.005" step="0.0001" value="0.002" style="width:200px;">
                        <span id="mouse-sens-value" style="color:#0f6; width:60px;">0.002</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label style="color:#0f6;">Field of View:</label>
                        <input type="range" id="fov-slider" min="60" max="120" step="5" value="85" style="width:200px;">
                        <span id="fov-value" style="color:#0f6; width:60px;">85¬∞</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label style="color:#0f6;">High Quality Graphics:</label>
                        <input type="checkbox" id="hifi-toggle" checked style="transform:scale(1.5);">
                    </div>
                </div>
            </div>
            
            <!-- Audio Tab -->
            <div id="tab-audio" class="settings-tab-content" style="display:none; padding:10px 0;">
                <h3 style="color:#0f6; margin:10px 0;">Audio Settings</h3>
                <div style="display:flex; flex-direction:column; gap:15px; font-size:13px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label style="color:#0f6;">Master Volume:</label>
                        <input type="range" id="master-volume" min="0" max="1" step="0.1" value="1" style="width:200px;">
                        <span id="volume-value" style="color:#0f6; width:60px;">100%</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label style="color:#0f6;">SFX Volume:</label>
                        <input type="range" id="sfx-volume" min="0" max="1" step="0.1" value="1" style="width:200px;">
                        <span id="sfx-value" style="color:#0f6; width:60px;">100%</span>
                    </div>
                </div>
            </div>
            
            <!-- Gameplay Tab -->
            <div id="tab-gameplay" class="settings-tab-content" style="display:none; padding:10px 0;">
                <h3 style="color:#0f6; margin:10px 0;">Gameplay Settings</h3>
                <div style="display:flex; flex-direction:column; gap:15px; font-size:13px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label style="color:#0f6;">Move Speed:</label>
                        <input type="range" id="move-speed" min="5" max="15" step="1" value="8" style="width:200px;">
                        <span id="speed-value" style="color:#0f6; width:60px;">8</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label style="color:#0f6;">Sprint Speed:</label>
                        <input type="range" id="sprint-speed" min="15" max="40" step="1" value="28" style="width:200px;">
                        <span id="sprint-value" style="color:#0f6; width:60px;">28</span>
                    </div>
                </div>
            </div>
            
            <div style="margin-top:20px; display:flex; gap:10px;">
                <button id="btn-settings-resume" class="menu-btn">‚ñ∂Ô∏è Resume Game</button>
                <button id="btn-settings-back" class="menu-btn secondary">‚Üê Back to Menu</button>
                <button id="btn-quit" class="menu-btn secondary">Quit to Menu</button>
            </div>
        </div>
    </div>

    <div id="ui-layer" style="display:none;">
        <div id="hud-top">
            <div id="hud-room-id">LOCAL_HOST</div>
            <div id="world-clock" style="margin-top:10px;">00:00</div>
            <div id="connection-status"></div>
            <div id="game-status" style="color:#0f0; margin-top:10px; font-weight:bold;">GAME ACTIVE</div>
        </div>
        <div id="hud-bottom">
            <div id="hud-ammo">Ammo: <span id="ammo-cur">30</span> / <span id="ammo-res">90</span></div>
            <div id="hud-health">HP: 100</div>
        </div>
        <div id="nametags-container" style="position:absolute; width:100%; height:100%; pointer-events:none;"></div>
        <div id="message-log" style="position:absolute; top:60px; left:10px; width:300px; max-height:200px; overflow:hidden; font-size:11px;"></div>
        <div id="interaction-prompt" style="position:absolute; bottom:60px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:#0f6; padding:10px 20px; border:1px solid #0f6; border-radius:5px; font-size:12px; display:none; pointer-events:none; z-index:100;">Press F to interact</div>
        <div id="minimap-container" style="position:absolute; bottom:100px; right:20px; width:200px; height:200px; border:2px solid #0f6; background:rgba(0,0,0,0.8); display:none;">
            <canvas id="minimap-canvas" width="200" height="200" style="display:block;"></canvas>
        </div>
        <div id="dialogue-box" style="position:absolute; bottom:50px; left:50%; transform:translateX(-50%); width:600px; background:rgba(0,0,0,0.9); border:2px solid #0f6; border-radius:10px; padding:20px; display:none; z-index:200;">
            <div style="margin-bottom:10px; border-bottom:1px solid #0f6; padding-bottom:10px;">
                <div id="npc-name" style="color:#ffd700; font-weight:bold; font-size:14px;"></div>
                <div id="npc-faction" style="color:#888; font-size:11px;"></div>
            </div>
            <div id="dialogue-text" style="color:#0f6; margin:15px 0; font-size:14px; min-height:40px;"></div>
            <div id="dialogue-options" style="display:flex; flex-direction:column; gap:10px;"></div>
        </div>
        <div id="selection-box" style="position:absolute; border:2px dashed #0f6; background:rgba(0,255,100,0.1); display:none; pointer-events:none;"></div>
        <div id="mode-text" style="position:absolute; top:50px; right:20px; color:#0f6; font-size:16px; font-weight:bold;">SEMI</div>
        
        <!-- CROSSHAIR AND HIT INDICATOR -->
        <div id="crosshair-container" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:30px; height:30px; pointer-events:none;">
            <div style="width:100%; height:100%; border:2px solid #0f6; border-radius:50%; opacity:0.6;"></div>
            <div style="position:absolute; top:-15px; left:50%; transform:translateX(-50%); width:3px; height:10px; background:#0f6;"></div>
            <div style="position:absolute; bottom:-15px; left:50%; transform:translateX(-50%); width:3px; height:10px; background:#0f6;"></div>
            <div style="position:absolute; left:-15px; top:50%; transform:translateY(-50%); width:10px; height:3px; background:#0f6;"></div>
            <div style="position:absolute; right:-15px; top:50%; transform:translateY(-50%); width:10px; height:3px; background:#0f6;"></div>
        </div>
        
        <!-- HIT MARKER -->
        <div id="hitmarker" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:40px; height:40px; border:2px solid #0f0; border-radius:50%; opacity:0; pointer-events:none; transition:opacity 0.1s;"></div>
        
        <!-- HUD CONTAINERS -->
        <div id="health-container" style="position:absolute; bottom:20px; left:20px; color:#0f6; font-size:14px;">
            <div>HP: <span id="hud-health-value">100</span>/100</div>
            <div style="width:100px; height:5px; background:#111; border:1px solid #0f6; margin-top:3px;">
                <div id="health-bar" style="height:100%; background:#0f0; width:100%; transition:width 0.1s;"></div>
            </div>
        </div>
        
        <div id="stamina-container" style="position:absolute; bottom:20px; right:20px; color:#0f6; font-size:14px;">
            <div>STAMINA: <span id="stamina-value">100</span>%</div>
            <div style="width:100px; height:5px; background:#111; border:1px solid #0f6; margin-top:3px;">
                <div id="stamina-bar" style="height:100%; background:#ffff00; width:100%; transition:width 0.1s;"></div>
            </div>
        </div>
        
        <!-- COMMANDER/TACTICAL VIEW OVERLAY -->
        <div id="commander-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,20,0,0.3); display:none; pointer-events:none; z-index:100;"></div>
        
        <!-- COMMAND PANEL -->
        <div id="command-panel" style="position:fixed; bottom:10px; left:10px; background:rgba(0,0,0,0.9); border:2px solid #0f6; padding:15px; display:none; z-index:90; color:#0f6; font-size:12px;">
            <div style="margin-bottom:10px; font-weight:bold;">--- TACTICAL VIEW ---</div>
            <div>A/D: Rotate View</div>
            <div>W/S: Zoom In/Out</div>
            <div>M: Exit Tactical</div>
        </div>
        
        <!-- MINIMAP (For tactical view) -->
        <div id="minimap-container" style="position:fixed; top:20px; right:20px; width:200px; height:200px; background:rgba(0,0,0,0.8); border:2px solid #0f6; display:none; z-index:95;">
            <canvas id="minimap-canvas" style="width:100%; height:100%;"></canvas>
        </div>
    </div>

    <div id="version-indicator">
        PHASE 7 ULTIMATE - Press F2 for Editor
    </div>

    <!-- PIPBOY MENU SYSTEM -->
    <div id="pipboy-menu" style="position:fixed; right:0; top:0; width:400px; height:100%; background:rgba(0,20,0,0.95); border-left:2px solid #0f6; display:none; flex-direction:column; z-index:1001; transform:translateX(500px); transition:transform 0.3s;">
        <div style="padding:20px; border-bottom:2px solid #0f6;">
            <div style="color:#0f6; font-size:20px; font-weight:bold;">PIP-BOY 3000</div>
            <div style="color:#0f6; font-size:12px; margin-top:5px;">MARKED: QUEST ACTIVE</div>
        </div>
        
        <div style="flex:1; overflow-y:auto; padding:15px; border-bottom:1px solid #0f6;">
            <div style="color:#0f6; margin-bottom:15px;">
                <div style="font-weight:bold; margin-bottom:5px;">STATUS</div>
                <div style="font-size:12px; margin:5px 0;">HP: <span id="pip-hp">100/100</span></div>
                <div style="font-size:12px; margin:5px 0;">STAMINA: <span id="pip-stam">100/100</span></div>
                <div style="font-size:12px; margin:5px 0;">AMMO: <span id="pip-ammo">90</span></div>
                <div style="font-size:12px; margin:5px 0;">RAD: 0</div>
            </div>
            
            <div style="color:#0f6; margin-bottom:15px;">
                <div style="font-weight:bold; margin-bottom:5px;">REPUTATION</div>
                <div style="font-size:12px; margin:5px 0;">GUARD: <span id="pip-rep-guard" style="color:#33ff33;">FRIENDLY</span></div>
                <div style="font-size:12px; margin:5px 0;">CITIZEN: <span id="pip-rep-civ" style="color:#cccc33;">NEUTRAL</span></div>
            </div>
            
            <div style="color:#0f6;">
                <div style="font-weight:bold; margin-bottom:5px;">INVENTORY</div>
                <div style="font-size:12px; margin:5px 0;">Weapons: 1</div>
                <div style="font-size:12px; margin:5px 0;">Items: 0</div>
                <div style="font-size:12px; margin:5px 0;">Weight: 0/75</div>
            </div>
        </div>
        
        <div style="padding:10px; background:rgba(0,0,0,0.5);">
            <button id="btn-close-pipboy" onclick="window.togglePipboy()" style="width:100%; padding:8px; background:#0f6; color:#000; border:none; font-weight:bold; cursor:pointer; border-radius:3px;">Close (I)</button>
        </div>
    </div>

    <div id="editor-overlay">
        <div class="editor-sidebar">
            <div class="editor-header">EDITOR</div>
            <button class="editor-tab active" onclick="window.switchEditorTab('spawn')">üì¶ SPAWN</button>
            <button class="editor-tab" onclick="window.switchEditorTab('world')">üåç WORLD</button>
            <button class="editor-tab" onclick="window.switchEditorTab('settings')">‚öôÔ∏è SETTINGS</button>
            <button class="editor-tab" onclick="window.switchEditorTab('save')">üíæ SAVE</button>
            <div style="margin-top: 30px;">
                <button class="editor-tool-btn" style="width:100%;" onclick="window.toggleEditor()">‚úï CLOSE [F2]</button>
            </div>
        </div>

        <div class="editor-main">
            <div class="editor-toolbar">
                <span style="font-weight: bold;">PHASE 7 ULTIMATE EDITOR</span>
            </div>
            <div class="editor-viewport">
                <div style="position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.8);
                            padding: 10px; border: 1px solid #00ffcc; font-size: 11px;">
                    <div>Editor Active | F2 to close</div>
                    <div>Click icons to spawn objects</div>
                </div>
            </div>
        </div>

        <div class="editor-properties">
            <div class="editor-header">TOOLS</div>

            <div class="editor-section active" id="section-spawn">
                <h3 style="color: #00ffcc; font-size: 14px;">SPAWN OBJECTS</h3>
                <div class="spawn-palette">
                    <div class="spawn-item" onclick="window.editorSpawn('building')">üè¢</div>
                    <div class="spawn-item" onclick="window.editorSpawn('tree')">üå≤</div>
                    <div class="spawn-item" onclick="window.editorSpawn('rock')">ü™®</div>
                    <div class="spawn-item" onclick="window.editorSpawn('crate')">üì¶</div>
                    <div class="spawn-item" onclick="window.editorSpawn('wall')">üß±</div>
                    <div class="spawn-item" onclick="window.editorSpawn('light')">üí°</div>
                </div>

                <h3 style="color: #00ffcc; font-size: 14px; margin-top: 20px;">SPAWN NPCs</h3>
                <div class="spawn-palette">
                    <div class="spawn-item" onclick="window.editorSpawnNPC('squad')">üë§</div>
                    <div class="spawn-item" onclick="window.editorSpawnNPC('citizen')">üßë</div>
                    <div class="spawn-item" onclick="window.editorSpawnNPC('raider')">‚ò†Ô∏è</div>
                    <div class="spawn-item" onclick="window.editorSpawnNPC('trader')">üí∞</div>
                </div>
            </div>

            <div class="editor-section" id="section-world">
                <h3 style="color: #00ffcc; font-size: 14px;">WORLD TOOLS</h3>
                <button class="editor-tool-btn" style="width:100%; margin:5px 0;" 
                        onclick="window.editorRegenWorld()">üîÑ REGENERATE WORLD</button>
                <input type="number" class="property-input" id="world-seed" 
                       placeholder="World Seed" value="12345">

                <h3 style="color: #00ffcc; font-size: 14px; margin-top: 20px;">WEATHER</h3>
                <button class="editor-tool-btn" style="width:48%; margin:2px;" 
                        onclick="window.editorWeather('clear')">‚òÄÔ∏è</button>
                <button class="editor-tool-btn" style="width:48%; margin:2px;" 
                        onclick="window.editorWeather('rain')">üåßÔ∏è</button>
                <button class="editor-tool-btn" style="width:48%; margin:2px;" 
                        onclick="window.editorWeather('fog')">üå´Ô∏è</button>
                <button class="editor-tool-btn" style="width:48%; margin:2px;" 
                        onclick="window.editorWeather('storm')">‚õàÔ∏è</button>

                <h3 style="color: #00ffcc; font-size: 14px; margin-top: 20px;">TIME</h3>
                <input type="range" class="property-input" id="time-slider" 
                       min="0" max="24" value="12" oninput="window.editorSetTime(this.value)">
            </div>

            <div class="editor-section" id="section-settings">
                <h3 style="color: #00ffcc; font-size: 14px;">PHYSICS</h3>
                <label style="font-size: 11px;">Gravity:</label>
                <input type="number" class="property-input" id="set-gravity" value="35">
                <label style="font-size: 11px;">Player Speed:</label>
                <input type="number" class="property-input" id="set-speed" value="8">
                <label style="font-size: 11px;">Jump Power:</label>
                <input type="number" class="property-input" id="set-jump" value="11">
                <button class="editor-tool-btn" style="width:100%; margin-top:10px;" 
                        onclick="window.editorApplySettings()">APPLY</button>
            </div>

            <div class="editor-section" id="section-save">
                <h3 style="color: #00ffcc; font-size: 14px;">SAVE/LOAD</h3>
                <button class="editor-tool-btn" style="width:100%; margin:5px 0;" 
                        onclick="window.editorSave()">üíæ SAVE WORLD</button>
                <button class="editor-tool-btn" style="width:100%; margin:5px 0;" 
                        onclick="window.editorLoad()">üìÇ LOAD WORLD</button>
                <button class="editor-tool-btn" style="width:100%; margin:5px 0;" 
                        onclick="window.editorExport()">üì§ EXPORT JSON</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="js/omni-ai-tester.js" defer></script>
    <script src="js/omni-ai-livecam.js" defer></script>
    <script>
        // Global logging to page for debugging
        window.pageLog = [];
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const msg = args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
            window.pageLog.push(msg);
            const logEl = document.getElementById('page-debug-log');
            if (logEl && window.pageLog.length > 0) {
                logEl.innerHTML = 'Recent logs:<br>' + window.pageLog.slice(-10).join('<br>');
            }
        };
        console.log('Page loaded, waiting for modules...');
        
        // Wrap the entire window in error protection
        const originalEval = window.eval;
        window.moduleLoadErrors = [];
        window.eval = function(code) {
            try {
                return originalEval.call(window, code);
            } catch (e) {
                console.error('[Module Eval Error]', e.message);
                window.moduleLoadErrors.push(e.message);
                throw e;
            }
        };
    </script>
    <script src="scripts/omni-main.js" defer></script>
    <script src="scripts/omni-diagnostics.js" defer></script>
    <script src="scripts/startup-verify.js" defer></script>
    <script>
        // Auto-run diagnostics after game loads (optional - user can call manually)
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.OmniDiagnostics) {
                    console.log('Run OmniDiagnostics.runAllChecks() in console to validate game systems');
                }
            }, 3000);
        });
        
        // Safety net: Force show menu if loading takes too long
        setTimeout(() => {
            const loadingScreen = document.getElementById('loading-screen');
            const menuOverlay = document.getElementById('menu-overlay');
            
            if (loadingScreen && loadingScreen.style.display !== 'none' && !loadingScreen.classList.contains('hidden')) {
                console.warn('[Safety Net] Loading screen still showing after 15 seconds, forcing menu display');
                loadingScreen.classList.add('hidden');
                if (menuOverlay) menuOverlay.style.display = 'flex';
                window.modulesReady = true;
                
                // Try to initialize UI if it exists
                if (window.initializeUI) {
                    try {
                        window.initializeUI();
                    } catch (e) {
                        console.error('[Safety Net] Error calling initializeUI:', e);
                    }
                }
            }
        }, 15000);
    </script>
    <div id="page-debug-log" style="position:fixed; bottom:10px; right:10px; background:rgba(0,0,0,0.8); color:#0f6; padding:10px; font-size:10px; max-width:300px; max-height:100px; overflow-y:auto; border:1px solid #0f6; z-index:5000; pointer-events:none;"></div>
</body>
</html>