// OMNI-OPS PIPBOY SYSTEM
try {
(function(){const PB={active:false,tab:'map',updateInterval:null,init:function(){console.log('[Pip-Boy] Ready');this.createUI();this.setupKeys();this.startUpdateLoop()},createUI:function(){const h=`<div id="pipboy-interface"><div class="pipboy-container"><div class="pipboy-topbar"><div class="pipboy-title">PIP-BOY 3000</div><div class="pipboy-stats-quick"><div>â¤ï¸ <span id="pb-hp">100</span></div><div>âš¡ <span id="pb-stam">100</span></div><div>ğŸ”« <span id="pb-ammo">30/90</span></div></div></div><div class="pipboy-nav"><div class="pipboy-tab active" onclick="window.PB && window.PB.switchTab(this, 'map')">ğŸ“ MAP</div><div class="pipboy-tab" onclick="window.PB && window.PB.switchTab(this, 'quests')">ğŸ“œ QUESTS</div><div class="pipboy-tab" onclick="window.PB && window.PB.switchTab(this, 'inv')">ğŸ’ INV</div><div style="flex:1"></div><div class="pipboy-tab" onclick="window.PB && window.PB.close()">âœ• [TAB]</div></div><div class="pipboy-content"><div id="pb-map" style="flex:1"><div class="pipboy-map-view"><div class="pipboy-map-canvas" id="pb-canvas"><div class="pipboy-map-grid"></div></div><div class="pipboy-map-legend"><div style="display:flex;align-items:center;gap:10px;margin:5px 0"><div style="width:10px;height:10px;border-radius:50%;background:#ff0"></div>You</div><div style="display:flex;align-items:center;gap:10px;margin:5px 0"><div style="width:10px;height:10px;border-radius:50%;background:#0f6"></div>Allies</div><div style="display:flex;align-items:center;gap:10px;margin:5px 0"><div style="width:10px;height:10px;border-radius:50%;background:#f44"></div>Enemies</div></div></div></div><div id="pb-quests" style="display:none;flex:1;overflow-y:auto;padding:20px"><h3 style="color:#0f6">ACTIVE QUESTS</h3><div class="pipboy-quest-item active"><div style="font-weight:700">Welcome to Wasteland</div><div style="font-size:11px;opacity:.8">Explore Citadel</div></div><div class="pipboy-quest-item"><div style="font-weight:700">Raider Problem</div><div style="font-size:11px;opacity:.8">Eliminate raiders</div></div></div><div id="pb-inv" style="display:none"><div class="pipboy-inventory-grid"><div class="pipboy-inv-item"><div style="font-size:36px">ğŸ”«</div><div style="font-size:12px;font-weight:700">M4A1</div><div style="font-size:10px">Ã—1</div></div><div class="pipboy-inv-item"><div style="font-size:36px">ğŸ’Š</div><div style="font-size:12px;font-weight:700">Stimpak</div><div style="font-size:10px">Ã—5</div></div><div class="pipboy-inv-item"><div style="font-size:36px">ğŸ“¦</div><div style="font-size:12px;font-weight:700">Ammo</div><div style="font-size:10px">Ã—10</div></div></div></div></div></div></div>`;document.body.insertAdjacentHTML('beforeend',h)},setupKeys:function(){const h=e=>{if(e.code==='Tab'&&!window.UE5?.active){e.preventDefault();this.active?this.close():this.open();return true}return false};if(window.OmniKeybinds&&window.OmniKeybinds.register){window.OmniKeybinds.register({id:'pipboy',priority:50,onKeyDown:h})}else{document.addEventListener('keydown',h)}},startUpdateLoop:function(){if(!this.updateInterval){this.updateInterval=setInterval(()=>{if(PB.active){PB.update();if(PB.tab==='map')PB.renderMap()}},100)}},stopUpdateLoop:function(){if(this.updateInterval){clearInterval(this.updateInterval);this.updateInterval=null}},open:function(){this.active=true;const el=document.getElementById('pipboy-interface');if(el)el.classList.add('active');if(typeof document.exitPointerLock==='function')document.exitPointerLock();this.update();this.renderMap();if(typeof addLogMessage==='function')addLogMessage('Pip-Boy opened')},close:function(){this.active=false;const el=document.getElementById('pipboy-interface');if(el)el.classList.remove('active');if(typeof safeRequestPointerLock==='function')safeRequestPointerLock()},switchTab:function(e,t){try{this.tab=t;document.querySelectorAll('.pipboy-tab').forEach(x=>x.classList.remove('active'));if(e)e.classList.add('active');['map','quests','inv'].forEach(x=>{const el=document.getElementById('pb-'+x);if(el)el.style.display=x===t?'flex':'none'});if(t==='map')this.renderMap()}catch(err){console.error('[Pip-Boy] switchTab error:',err)}},update:function(){if(window.player){const h=document.getElementById('pb-hp');const s=document.getElementById('pb-stam');const a=document.getElementById('pb-ammo');if(h)h.textContent=Math.round(window.player.health);if(s)s.textContent=Math.round(window.player.stamina);if(a)a.textContent=window.player.ammo+'/'+window.player.reserveAmmo}},renderMap:function(){const c=document.getElementById('pb-canvas');if(!c)return;const ex=c.querySelectorAll('.pipboy-map-marker');ex.forEach(m=>m.remove());const w=c.offsetWidth,h=c.offsetHeight,ws=500;if(window.cameraRig){const m=document.createElement('div');m.className='pipboy-map-marker pipboy-map-player';m.style.left=((window.cameraRig.position.x+ws/2)/ws)*w+'px';m.style.top=((window.cameraRig.position.z+ws/2)/ws)*h+'px';c.appendChild(m)}if(window.aiUnits){window.aiUnits.forEach(n=>{if(!n.mesh)return;const m=document.createElement('div');m.className='pipboy-map-marker';if(n.faction===window.FACTIONS?.RAIDER){m.style.background='#f44';m.style.boxShadow='0 0 10px #f44'}m.style.left=((n.mesh.position.x+ws/2)/ws)*w+'px';m.style.top=((n.mesh.position.z+ws/2)/ws)*h+'px';c.appendChild(m)})}}};window.PB=PB;if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',()=>PB.init());else PB.init()})();
} catch(err) {
  console.error('[Pip-Boy] Module error:', err);
}


