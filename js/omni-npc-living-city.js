// OMNI-OPS LIVING NPC CITY
(function(){const LC={citizens:[],debug:false,init:function(){console.log('[Living City] Ready');this.createUI();this.setupKeys();this.spawnCitizens()},createUI:function(){const h=`<div id="npc-debug-panel"><div class="npc-debug-title">ðŸ¤– NPC BEHAVIORS [N]</div><div id="npc-debug-content"></div></div>`;document.body.insertAdjacentHTML('beforeend',h)},setupKeys:function(){document.addEventListener('keydown',e=>{if(e.key==='n'||e.key==='N'){this.debug=!this.debug;document.getElementById('npc-debug-panel').classList.toggle('visible')}})},spawnCitizens:function(){setTimeout(()=>{if(!window.scene)return;console.log('[Living City] Spawning 8 NPCs...');for(let i=0;i<5;i++){const a=(i/5)*Math.PI*2,r=30;this.createCitizen(Math.cos(a)*r,Math.sin(a)*r,window.FACTIONS?.CITIZEN)}for(let i=0;i<2;i++){const a=(i/2)*Math.PI*2,r=40;this.createCitizen(Math.cos(a)*r,Math.sin(a)*r,window.FACTIONS?.GUARD)}this.createCitizen(25,25,window.FACTIONS?.TRADER);console.log('[Living City] All NPCs spawned')},2000)},createCitizen:function(x,z,f){if(!window.createAIUnit)return;const c=window.createAIUnit(x,z,f);c.schedule={0:'sleeping',6:'waking',7:'breakfast',8:'working',17:'shopping',18:'dinner',22:'sleeping'};c.activity='idle';c.home={x:x,z:z};c.workplace={x:x+Math.random()*50-25,z:z+Math.random()*50-25};c.needs={hunger:100,energy:100,social:100};this.citizens.push(c);if(window.aiUnits)window.aiUnits.push(c);return c},update:function(){const h=window.gameState?.timeOfDay||12;this.citizens.forEach(c=>{if(!c.mesh)return;c.needs.hunger=Math.max(0,c.needs.hunger-0.01);c.needs.energy=Math.max(0,c.needs.energy-0.005);c.needs.social=Math.max(0,c.needs.social-0.008);let a='idle';for(let hr in c.schedule){if(h>=parseInt(hr))a=c.schedule[hr]}if(c.needs.hunger<30)a='eating';else if(c.needs.energy<20)a='sleeping';else if(c.needs.social<30)a='socializing';c.activity=a;if(a==='sleeping'){c.mesh.position.x+=(c.home.x-c.mesh.position.x)*0.02;c.mesh.position.z+=(c.home.z-c.mesh.position.z)*0.02}else if(a==='working'){c.mesh.position.x+=(c.workplace.x-c.mesh.position.x)*0.01;c.mesh.position.z+=(c.workplace.z-c.mesh.position.z)*0.01}else if(a==='eating')c.needs.hunger=Math.min(100,c.needs.hunger+0.5)});if(this.debug)this.updateDebug()},updateDebug:function(){const d=document.getElementById('npc-debug-content');if(!d)return;let h='';this.citizens.slice(0,5).forEach((n,i)=>{h+=`<div class="npc-debug-item"><strong>NPC #${i}</strong> - ${n.activity}<br><small>H:${Math.round(n.needs.hunger)}% E:${Math.round(n.needs.energy)}% S:${Math.round(n.needs.social)}%</small></div>`});d.innerHTML=h||'No NPCs'}};window.LC=LC;if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',()=>LC.init());else LC.init();setInterval(()=>{if(window.isGameActive&&!window.gameState?.isPaused)LC.update()},100)})();